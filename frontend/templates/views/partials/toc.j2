{% set empty_toc = doc.format.toc == '<div class="toc">\n<ul></ul>\n</div>\n' or not doc.format.toc %}

{% if not empty_toc and (doc.toc or doc.content.find('[TOC]')) %}
{% do doc.icons.useIcon('icons/contentmenu.svg') %}
{% do doc.icons.useIcon('icons/close.svg') %}
<section class="ap--toc">
  {% do doc.styles.addCssFile('/css/components/atoms/sidebar-toggle.css') %}
  {% do doc.styles.addCssFile('/css/components/organisms/toc.css') %}

  <div class="ap-o-toc" [class]="contentmenuopen ? 'ap-o-toc contentmenuopen' : 'ap-o-toc'">
    <label class="ap-o-toc-toggle" for="toc" on="tap:AMP.setState({contentmenuopen: !contentmenuopen})" role="contentmenutrigger" tabindex="0">
      <p class="ap-o-toc-hl">Table of contents</p>
    </label>
    <input class="ap-a-sidebar-toggle-input ap-a-sidebar-toggle-input-toc" type="checkbox" name="toc" id="toc" autocomplete="off">
    {# Unwrap TOC from useless markup and strip first level #}
    {% set toc = doc.format.toc.replace('<div class="toc">\n<ul>\n', '<ul>').replace('\n</ul>\n</div>', '</ul>') %}
    {{ toc|safe }}
  </div>
</section>
{% endif %}
